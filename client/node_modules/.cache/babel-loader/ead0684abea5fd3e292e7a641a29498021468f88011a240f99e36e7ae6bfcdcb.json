{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\maxhi\\\\Desktop\\\\Projects\\\\Whitespace\\\\client\\\\src\\\\TextEditor.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useCallback, useState, useRef, use } from 'react';\nimport Quill from \"quill\";\nimport \"quill/dist/quill.snow.css\";\nimport { io } from \"socket.io-client\";\nimport { useParams } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TOOLBAR_OPTIONS = [[{\n  header: [1, 2, 3, 4, 5, 6, false]\n}], [{\n  font: []\n}], [{\n  list: \"ordered\"\n}, {\n  list: \"bullet\"\n}], [\"bold\", \"italic\", \"underline\"], [{\n  color: []\n}, {\n  background: []\n}], [{\n  script: \"sub\"\n}, {\n  script: \"super\"\n}], [{\n  align: []\n}], [\"image\", \"blockquote\", \"code-block\"], [\"clean\"]];\nconst SAVE_INTERVAL_MS = 500;\nconst PREDICTION_DEBOUNCE_MS = 500;\nconst MIN_CHARS_FOR_PREDICTION = 5;\nexport default function TextEditor() {\n  _s();\n  const [socket, setSocket] = useState(null);\n  const [quill, setQuill] = useState(null);\n  const {\n    id: documentId\n  } = useParams();\n  const [isPredicting, setIsPredicting] = useState(false);\n  const debounceTimerRef = useRef(null);\n  const suggestionRef = useRef(null);\n  const customLinkRef = useRef(null);\n  useEffect(() => {\n    const s = io(\"http://localhost:3001\");\n    setSocket(s);\n    return () => {\n      s.disconnect();\n    };\n  }, []);\n  useEffect(() => {\n    if (!quill) return;\n\n    // Give time for the toolbar to be fully rendered\n    setTimeout(() => {\n      const toolbars = document.querySelectorAll('.ql-toolbar.ql-snow');\n      let toolbarElement = null;\n      toolbars.forEach(toolbar => {\n        // Check if this toolbar is a sibling or connected to our quill instance\n        if (toolbar.nextElementSibling === quill.container || toolbar.parentElement === quill.container.parentElement) {\n          toolbarElement = toolbar;\n        }\n      });\n      if (!toolbarElement) {\n        console.error(\"Could not find toolbar element\");\n        return;\n      }\n\n      // Check if we already added our custom link to prevent duplicates\n      if (toolbarElement.querySelector('.ql-custom-link')) {\n        return;\n      }\n\n      // Create a new format group container\n      const formatGroup = document.createElement('span');\n      formatGroup.className = 'ql-formats';\n\n      // Create the custom link\n      const customLink = document.createElement('a');\n      customLink.href = '/'; // Home redirect\n      customLink.className = 'ql-custom-link';\n      customLink.title = 'Go to Homepage';\n\n      // Create an image element\n      const logoImage = document.createElement('img');\n      logoImage.src = '/resources/logo2.png'; // Replace with your logo path\n      logoImage.alt = 'Home';\n      logoImage.style.height = '40px'; // Adjust size as needed\n      logoImage.style.width = 'auto';\n      logoImage.style.verticalAlign = 'middle';\n      customLink.appendChild(logoImage);\n      customLink.setAttribute('style', `\n                cursor: pointer;\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n            `);\n      customLink.addEventListener('mouseover', () => {\n        customLink.style.boxShadow = '0 4px 4px rgba(0, 0, 0, 0.2)';\n      });\n      customLink.addEventListener('mouseout', () => {\n        customLink.style.boxShadow = 'none';\n      });\n      customLinkRef.current = customLink;\n      formatGroup.appendChild(customLink);\n      toolbarElement.insertBefore(formatGroup, toolbarElement.firstChild);\n      console.log(\"Custom logo link added to toolbar on the left side\");\n    }, 500);\n    return () => {\n      if (customLinkRef.current) {\n        const parent = customLinkRef.current.parentElement;\n        if (parent) {\n          var _parent$parentElement;\n          (_parent$parentElement = parent.parentElement) === null || _parent$parentElement === void 0 ? void 0 : _parent$parentElement.removeChild(parent);\n        }\n      }\n    };\n  }, [quill]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    const interval = setInterval(() => {\n      socket.emit(\"save-document\", quill.getContents());\n    }, SAVE_INTERVAL_MS);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [socket, quill]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    socket.once(\"load-document\", document => {\n      quill.setContents(document);\n      quill.enable();\n    });\n    socket.emit(\"get-document\", documentId);\n  }, [quill, socket, documentId]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    const handler = delta => {\n      quill.updateContents(delta);\n    };\n    socket.on(\"receive-changes\", handler);\n    return () => {\n      socket.off(\"receive-changes\", handler);\n    };\n  }, [socket, quill]);\n  const fetchPrediction = async text => {\n    try {\n      setIsPredicting(true);\n      const response = await fetch(\"http://localhost:3001/api/predict\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          text\n        })\n      });\n      if (!response.ok) {\n        throw new Error(\"Network response was not ok\");\n      }\n      const data = await response.json();\n      return data.prediction;\n    } catch (error) {\n      console.error(\"Error fetching prediction:\", error);\n      return \"\";\n    } finally {\n      setIsPredicting(false);\n    }\n  };\n  const handleTextChange = useCallback(async (delta, oldDelta, source) => {\n    if (source !== \"user\" || !quill || isPredicting) return;\n    const selection = quill.getSelection();\n    if (!selection) return;\n    if (suggestionRef.current && delta.ops) {\n      const insertOp = delta.ops.find(op => op.insert);\n      const retainOp = delta.ops.find(op => op.retain);\n      if (insertOp && retainOp && retainOp.retain === suggestionRef.current.start) {\n        quill.formatText(retainOp.retain, insertOp.insert.length, {\n          color: 'black',\n          'user-suggestion': false\n        });\n        suggestionRef.current.start += insertOp.insert.length;\n      } else if (insertOp && retainOp && retainOp.retain > suggestionRef.current.start && retainOp.retain < suggestionRef.current.start + suggestionRef.current.length) {\n        // Calculate where in the suggestion they're typing\n        const offset = retainOp.retain - suggestionRef.current.start;\n        quill.formatText(retainOp.retain, insertOp.insert.length, {\n          color: 'black',\n          'user-suggestion': false\n        });\n        const newLength = suggestionRef.current.length - offset;\n        suggestionRef.current = {\n          start: retainOp.retain + insertOp.insert.length,\n          length: newLength - insertOp.insert.length\n        };\n        if (suggestionRef.current.length <= 0) {\n          suggestionRef.current = null;\n        }\n      }\n    }\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n    const cursorPosition = selection.index;\n    const fullText = quill.getText(0, cursorPosition);\n    const contextLength = Math.min(100, cursorPosition);\n    const start = Math.max(0, cursorPosition - contextLength);\n    const recentText = quill.getText(start, cursorPosition - start);\n    if (fullText.length < MIN_CHARS_FOR_PREDICTION) return;\n    if (suggestionRef.current) {\n      quill.deleteText(suggestionRef.current.start, suggestionRef.current.length);\n      suggestionRef.current = null;\n    }\n    debounceTimerRef.current = setTimeout(async () => {\n      const prediction = await fetchPrediction(recentText);\n      if (prediction && prediction.length > 0 && quill.hasFocus()) {\n        const currentSelection = quill.getSelection();\n        if (!currentSelection) return;\n        const currentPosition = currentSelection.index;\n        quill.insertText(currentPosition, prediction, {\n          color: '#aaaaaa',\n          'user-suggestion': true,\n          'non-editable': true\n        });\n        suggestionRef.current = {\n          start: currentPosition,\n          length: prediction.length\n        };\n        quill.setSelection(currentSelection.index, 0);\n      }\n    }, PREDICTION_DEBOUNCE_MS);\n  }, [quill, isPredicting]);\n  const handleKeyDown = useCallback(event => {\n    console.log(\"Key pressed:\", event.key, \"Suggestion:\", suggestionRef.current);\n    if (!quill || !suggestionRef.current) return;\n    if (event.key === 'Tab' && suggestionRef.current) {\n      event.preventDefault();\n      const {\n        start,\n        length\n      } = suggestionRef.current;\n      quill.formatText(start, length, {\n        color: 'black',\n        'user-suggestion': false\n      });\n      quill.setSelection(start + length, 0);\n      suggestionRef.current = null;\n    } else if (event.key === 'Escape' && suggestionRef.current) {\n      event.preventDefault();\n      const {\n        start,\n        length\n      } = suggestionRef.current;\n      quill.deleteText(start, length);\n      suggestionRef.current = null;\n    } else if (event.ctrlKey && event.key === 'ArrowRight' && suggestionRef.current) {\n      event.preventDefault();\n      const {\n        start,\n        length\n      } = suggestionRef.current;\n      const text = quill.getText(start, length);\n      const nextSpaceIndex = text.indexOf(' ');\n      let wordLength;\n      if (nextSpaceIndex === -1) {\n        wordLength = length;\n      } else {\n        wordLength = nextSpaceIndex + 1;\n      }\n      quill.formatText(start, wordLength, {\n        color: 'black',\n        'user-suggestion': false\n      });\n      if (wordLength < length) {\n        suggestionRef.current = {\n          start: start + wordLength,\n          length: length - wordLength\n        };\n      } else {\n        suggestionRef.current = null;\n      }\n      quill.setSelection(start + wordLength, 0);\n    } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft' || event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n      const selection = quill.getSelection();\n      if (!selection) return;\n      const {\n        start,\n        length\n      } = suggestionRef.current;\n      if (selection.index >= start && selection.index <= start + length) {\n        quill.setSelection(start, 0);\n        event.preventDefault();\n      }\n    } else if (event.key === 'Backspace' || event.key === 'Delete') {\n      const selection = quill.getSelection();\n      if (!selection) return;\n      const {\n        start,\n        length\n      } = suggestionRef.current;\n      if (selection.index >= start && selection.index <= start + length) {\n        quill.deleteText(start, length);\n        suggestionRef.current = null;\n      }\n    }\n  }, [quill]);\n  const handleClick = useCallback(event => {\n    if (!quill || !suggestionRef.current) return;\n    const selection = quill.getSelection();\n    if (!selection) return;\n    const {\n      start,\n      length\n    } = suggestionRef.current;\n    if (selection.index >= start && selection.index <= start + length) {\n      quill.setSelection(start, 0);\n      event.preventDefault();\n    }\n  }, [quill]);\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    const handler = (delta, oldDelta, source) => {\n      if (source !== \"user\") return;\n      socket.emit(\"send-changes\", delta);\n    };\n    quill.on(\"text-change\", handler);\n    quill.on(\"text-change\", handleTextChange);\n    if (quill.root) {\n      quill.root.addEventListener(\"keydown\", handleKeyDown);\n      quill.root.addEventListener(\"click\", handleClick);\n    }\n    return () => {\n      quill.off(\"text-change\", handler);\n      quill.off(\"text-change\", handleTextChange);\n      if (quill.root) {\n        quill.root.removeEventListener(\"keydown\", handleKeyDown);\n        quill.root.removeEventListener(\"click\", handleClick);\n      }\n    };\n  }, [socket, quill, handleTextChange, handleKeyDown, handleClick]);\n  useEffect(() => {\n    if (!quill || !quill.root) return;\n\n    // Create a handler that runs before Quill's internal handlers\n    const preemptiveTabHandler = e => {\n      if (e.key === 'Tab' && suggestionRef.current) {\n        console.log(\"Intercepted Tab with active suggestion\");\n        // Stop the event completely\n        e.preventDefault();\n        e.stopImmediatePropagation();\n\n        // Apply the suggestion\n        const {\n          start,\n          length\n        } = suggestionRef.current;\n\n        // Use a timeout to ensure this runs after the event cycle\n        setTimeout(() => {\n          quill.formatText(start, length, {\n            color: 'black',\n            'user-suggestion': false\n          });\n          quill.setSelection(start + length, 0);\n          suggestionRef.current = null;\n        }, 0);\n        return false;\n      }\n    };\n    quill.root.addEventListener('keydown', preemptiveTabHandler, {\n      capture: true,\n      passive: false\n    });\n    return () => {\n      quill.root.removeEventListener('keydown', preemptiveTabHandler, {\n        capture: true,\n        passive: false\n      });\n    };\n  }, [quill]);\n  const wrapperRef = useCallback(wrapper => {\n    if (wrapper === null) return;\n    wrapper.innerHTML = \"\";\n    const editor = document.createElement(\"div\");\n    wrapper.append(editor);\n    const q = new Quill(editor, {\n      theme: \"snow\",\n      modules: {\n        toolbar: TOOLBAR_OPTIONS\n      }\n    });\n    q.disable();\n    q.setText(\"\");\n    setQuill(q);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-container\",\n      ref: wrapperRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 13\n    }, this), isPredicting && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"prediction-indicator\",\n      children: /*#__PURE__*/_jsxDEV(\"small\", {\n        children: \"Thinking...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 427,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 423,\n    columnNumber: 9\n  }, this);\n}\n_s(TextEditor, \"GUihubcMSH1opJyPIRvdAsuPBFc=\", false, function () {\n  return [useParams];\n});\n_c = TextEditor;\nvar _c;\n$RefreshReg$(_c, \"TextEditor\");","map":{"version":3,"names":["React","useEffect","useCallback","useState","useRef","use","Quill","io","useParams","jsxDEV","_jsxDEV","TOOLBAR_OPTIONS","header","font","list","color","background","script","align","SAVE_INTERVAL_MS","PREDICTION_DEBOUNCE_MS","MIN_CHARS_FOR_PREDICTION","TextEditor","_s","socket","setSocket","quill","setQuill","id","documentId","isPredicting","setIsPredicting","debounceTimerRef","suggestionRef","customLinkRef","s","disconnect","setTimeout","toolbars","document","querySelectorAll","toolbarElement","forEach","toolbar","nextElementSibling","container","parentElement","console","error","querySelector","formatGroup","createElement","className","customLink","href","title","logoImage","src","alt","style","height","width","verticalAlign","appendChild","setAttribute","addEventListener","boxShadow","current","insertBefore","firstChild","log","parent","_parent$parentElement","removeChild","interval","setInterval","emit","getContents","clearInterval","once","setContents","enable","handler","delta","updateContents","on","off","fetchPrediction","text","response","fetch","method","headers","body","JSON","stringify","ok","Error","data","json","prediction","handleTextChange","oldDelta","source","selection","getSelection","ops","insertOp","find","op","insert","retainOp","retain","start","formatText","length","offset","newLength","clearTimeout","cursorPosition","index","fullText","getText","contextLength","Math","min","max","recentText","deleteText","hasFocus","currentSelection","currentPosition","insertText","setSelection","handleKeyDown","event","key","preventDefault","ctrlKey","nextSpaceIndex","indexOf","wordLength","handleClick","root","removeEventListener","preemptiveTabHandler","e","stopImmediatePropagation","capture","passive","wrapperRef","wrapper","innerHTML","editor","append","q","theme","modules","disable","setText","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/maxhi/Desktop/Projects/Whitespace/client/src/TextEditor.js"],"sourcesContent":["import React, { useEffect, useCallback, useState, useRef, use } from 'react'\r\nimport Quill from \"quill\"\r\nimport \"quill/dist/quill.snow.css\"\r\nimport { io } from \"socket.io-client\"\r\nimport { useParams } from \"react-router-dom\"\r\n\r\nconst TOOLBAR_OPTIONS = [\r\n    [{ header: [1, 2, 3, 4, 5, 6, false] }],\r\n    [{ font: [] }],\r\n    [{ list: \"ordered\" }, { list: \"bullet\" }],\r\n    [\"bold\", \"italic\", \"underline\"],\r\n    [{ color: [] }, { background: [] }],\r\n    [{ script: \"sub\" }, { script: \"super\" }],\r\n    [{ align: [] }],\r\n    [\"image\", \"blockquote\", \"code-block\"],\r\n    [\"clean\"],\r\n]\r\nconst SAVE_INTERVAL_MS = 500\r\nconst PREDICTION_DEBOUNCE_MS = 500\r\nconst MIN_CHARS_FOR_PREDICTION = 5\r\n\r\nexport default function TextEditor() {\r\n    const [socket, setSocket] = useState(null)\r\n    const [quill, setQuill] = useState(null)\r\n    const { id: documentId } = useParams()\r\n    const [isPredicting, setIsPredicting] = useState(false)\r\n    const debounceTimerRef = useRef(null)\r\n    const suggestionRef = useRef(null)\r\n    const customLinkRef = useRef(null)\r\n\r\n    useEffect(() => {\r\n        const s = io(\"http://localhost:3001\")\r\n        setSocket(s)\r\n\r\n        return () => {\r\n            s.disconnect()\r\n        }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (!quill) return;\r\n        \r\n        // Give time for the toolbar to be fully rendered\r\n        setTimeout(() => {\r\n            const toolbars = document.querySelectorAll('.ql-toolbar.ql-snow');\r\n            \r\n            let toolbarElement = null;\r\n            toolbars.forEach(toolbar => {\r\n                // Check if this toolbar is a sibling or connected to our quill instance\r\n                if (toolbar.nextElementSibling === quill.container || \r\n                    toolbar.parentElement === quill.container.parentElement) {\r\n                    toolbarElement = toolbar;\r\n                }\r\n            });\r\n            \r\n            if (!toolbarElement) {\r\n                console.error(\"Could not find toolbar element\");\r\n                return;\r\n            }\r\n            \r\n            // Check if we already added our custom link to prevent duplicates\r\n            if (toolbarElement.querySelector('.ql-custom-link')) {\r\n                return;\r\n            }\r\n            \r\n            // Create a new format group container\r\n            const formatGroup = document.createElement('span');\r\n            formatGroup.className = 'ql-formats';\r\n            \r\n            // Create the custom link\r\n            const customLink = document.createElement('a');\r\n            customLink.href = '/'; // Home redirect\r\n            customLink.className = 'ql-custom-link';\r\n            customLink.title = 'Go to Homepage';\r\n            \r\n            // Create an image element\r\n            const logoImage = document.createElement('img');\r\n            logoImage.src = '/resources/logo2.png'; // Replace with your logo path\r\n            logoImage.alt = 'Home';\r\n            logoImage.style.height = '40px'; // Adjust size as needed\r\n            logoImage.style.width = 'auto';\r\n            logoImage.style.verticalAlign = 'middle';\r\n            \r\n            customLink.appendChild(logoImage);\r\n            \r\n            customLink.setAttribute('style', `\r\n                cursor: pointer;\r\n                display: inline-flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n            `);\r\n            \r\n            customLink.addEventListener('mouseover', () => {\r\n                customLink.style.boxShadow = '0 4px 4px rgba(0, 0, 0, 0.2)';\r\n            });\r\n            \r\n            customLink.addEventListener('mouseout', () => {\r\n                customLink.style.boxShadow = 'none';\r\n            });\r\n            \r\n            customLinkRef.current = customLink;\r\n            \r\n            formatGroup.appendChild(customLink);\r\n            \r\n            toolbarElement.insertBefore(formatGroup, toolbarElement.firstChild);\r\n            \r\n            console.log(\"Custom logo link added to toolbar on the left side\");\r\n        }, 500);\r\n        \r\n        return () => {\r\n            if (customLinkRef.current) {\r\n                const parent = customLinkRef.current.parentElement;\r\n                if (parent) {\r\n                    parent.parentElement?.removeChild(parent);\r\n                }\r\n            }\r\n        };\r\n    }, [quill]);\r\n\r\n    useEffect(() => {\r\n        if (socket == null || quill == null) return\r\n\r\n        const interval = setInterval(() => {\r\n            socket.emit(\"save-document\", quill.getContents())\r\n        }, SAVE_INTERVAL_MS)\r\n\r\n        return () => {\r\n            clearInterval(interval)\r\n        }\r\n    }, [socket, quill])\r\n\r\n    useEffect(() => {\r\n        if (socket == null || quill == null) return\r\n\r\n        socket.once(\"load-document\", (document) => {\r\n            quill.setContents(document)\r\n            quill.enable()\r\n        })\r\n\r\n        socket.emit(\"get-document\", documentId)\r\n    }, [quill, socket, documentId])\r\n\r\n    useEffect(() => {\r\n        if (socket == null || quill == null) return\r\n        \r\n        const handler = (delta) => {\r\n            quill.updateContents(delta)\r\n        }\r\n        socket.on(\"receive-changes\", handler)\r\n\r\n        return () => {\r\n            socket.off(\"receive-changes\", handler)\r\n        }\r\n    }, [socket, quill])\r\n\r\n    const fetchPrediction = async (text) => {\r\n        try {\r\n            setIsPredicting(true)\r\n            const response = await fetch(\"http://localhost:3001/api/predict\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ text }),\r\n            });\r\n            if (!response.ok) {\r\n                throw new Error(\"Network response was not ok\")\r\n            }\r\n            const data = await response.json()\r\n            return data.prediction\r\n        } catch (error) {\r\n            console.error(\"Error fetching prediction:\", error)\r\n            return \"\"\r\n        } finally {\r\n            setIsPredicting(false)\r\n        }\r\n    };\r\n\r\n    const handleTextChange = useCallback(async (delta, oldDelta, source) => {\r\n        if (source !== \"user\" || !quill || isPredicting) return\r\n\r\n        const selection = quill.getSelection();\r\n        if (!selection) return\r\n\r\n        if (suggestionRef.current && delta.ops) {\r\n            const insertOp = delta.ops.find(op => op.insert)\r\n            const retainOp = delta.ops.find(op => op.retain)\r\n\r\n            if (insertOp && retainOp && retainOp.retain === suggestionRef.current.start) {\r\n                quill.formatText(retainOp.retain, insertOp.insert.length, { \r\n                    color: 'black', \r\n                    'user-suggestion': false \r\n                });\r\n                \r\n                suggestionRef.current.start += insertOp.insert.length;\r\n            }\r\n            else if (insertOp && retainOp && \r\n                     retainOp.retain > suggestionRef.current.start && \r\n                     retainOp.retain < suggestionRef.current.start + suggestionRef.current.length) {\r\n                \r\n                // Calculate where in the suggestion they're typing\r\n                const offset = retainOp.retain - suggestionRef.current.start;\r\n                \r\n                quill.formatText(retainOp.retain, insertOp.insert.length, { \r\n                    color: 'black', \r\n                    'user-suggestion': false \r\n                });\r\n                \r\n                const newLength = suggestionRef.current.length - offset;\r\n                suggestionRef.current = {\r\n                    start: retainOp.retain + insertOp.insert.length,\r\n                    length: newLength - insertOp.insert.length\r\n                };\r\n                \r\n                if (suggestionRef.current.length <= 0) {\r\n                    suggestionRef.current = null;\r\n                }\r\n            }\r\n        }\r\n        \r\n        if (debounceTimerRef.current) {\r\n            clearTimeout(debounceTimerRef.current)\r\n        }\r\n\r\n        const cursorPosition = selection.index\r\n        const fullText = quill.getText(0, cursorPosition)\r\n        const contextLength = Math.min(100, cursorPosition)\r\n        const start = Math.max(0, cursorPosition - contextLength)\r\n        const recentText = quill.getText(start, cursorPosition - start)\r\n\r\n        if (fullText.length < MIN_CHARS_FOR_PREDICTION) return\r\n\r\n        if (suggestionRef.current) {\r\n            quill.deleteText(\r\n                suggestionRef.current.start,\r\n                suggestionRef.current.length,\r\n            )\r\n            suggestionRef.current = null\r\n        }\r\n\r\n        debounceTimerRef.current = setTimeout(async () => {\r\n            const prediction = await fetchPrediction(recentText)\r\n            if (prediction && prediction.length > 0 && quill.hasFocus()) {\r\n                const currentSelection = quill.getSelection();\r\n                if (!currentSelection) return;\r\n                \r\n                const currentPosition = currentSelection.index;\r\n                \r\n                quill.insertText(\r\n                    currentPosition, \r\n                    prediction,\r\n                    { color: '#aaaaaa', 'user-suggestion': true, 'non-editable': true },\r\n                );\r\n                \r\n                suggestionRef.current = {\r\n                    start: currentPosition,\r\n                    length: prediction.length\r\n                };\r\n\r\n                quill.setSelection(currentSelection.index, 0);\r\n            }\r\n        }, PREDICTION_DEBOUNCE_MS);\r\n    }, [quill, isPredicting])\r\n\r\n    const handleKeyDown = useCallback((event) => {\r\n        console.log(\"Key pressed:\", event.key, \"Suggestion:\", suggestionRef.current)\r\n        if (!quill || !suggestionRef.current) return\r\n\r\n        if (event.key === 'Tab' && suggestionRef.current) {\r\n            event.preventDefault();\r\n            const { start, length } = suggestionRef.current;\r\n            quill.formatText(start, length, { color: 'black', 'user-suggestion': false });\r\n            quill.setSelection(start + length, 0);\r\n            suggestionRef.current = null;\r\n        } else if (event.key === 'Escape' && suggestionRef.current) {\r\n            event.preventDefault();\r\n            \r\n            const { start, length } = suggestionRef.current;\r\n            quill.deleteText(start, length);\r\n            suggestionRef.current = null;\r\n        } else if (event.ctrlKey && event.key === 'ArrowRight' && suggestionRef.current) {\r\n            event.preventDefault();\r\n            const { start, length } = suggestionRef.current;\r\n            \r\n            const text = quill.getText(start, length);\r\n            const nextSpaceIndex = text.indexOf(' ');\r\n            \r\n            let wordLength;\r\n            if (nextSpaceIndex === -1) {\r\n                wordLength = length;\r\n            } else {\r\n                wordLength = nextSpaceIndex + 1;\r\n            }\r\n            \r\n            quill.formatText(start, wordLength, { color: 'black', 'user-suggestion': false });\r\n            \r\n            if (wordLength < length) {\r\n                suggestionRef.current = {\r\n                    start: start + wordLength,\r\n                    length: length - wordLength\r\n                };\r\n            } else {\r\n                suggestionRef.current = null;\r\n            }\r\n            quill.setSelection(start + wordLength, 0);\r\n        } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft' || event.key === 'ArrowUp' || event.key === 'ArrowDown') {\r\n    \r\n            const selection = quill.getSelection();\r\n            if (!selection) return;\r\n        \r\n            const { start, length } = suggestionRef.current;\r\n        \r\n            if (selection.index >= start && selection.index <= start + length) {\r\n                quill.setSelection(start, 0);\r\n                event.preventDefault();\r\n            }\r\n        } else if (event.key === 'Backspace' || event.key === 'Delete') {\r\n            const selection = quill.getSelection();\r\n            if (!selection) return;\r\n        \r\n            const { start, length } = suggestionRef.current;\r\n        \r\n            if (selection.index >= start && selection.index <= start + length) {\r\n                quill.deleteText(start, length);\r\n                suggestionRef.current = null;\r\n            }\r\n        }\r\n    }, [quill]);\r\n\r\n    const handleClick = useCallback((event) => {\r\n        if (!quill || !suggestionRef.current) return;\r\n    \r\n        const selection = quill.getSelection();\r\n        if (!selection) return;\r\n    \r\n        const { start, length } = suggestionRef.current;\r\n    \r\n        if (selection.index >= start && selection.index <= start + length) {\r\n            quill.setSelection(start, 0);\r\n            event.preventDefault();\r\n        }\r\n    }, [quill]);\r\n\r\n    useEffect(() => {\r\n        if (socket == null || quill == null) return\r\n\r\n        const handler = (delta, oldDelta, source) => {\r\n            if (source !== \"user\") return\r\n            socket.emit(\"send-changes\", delta)\r\n        }\r\n        quill.on(\"text-change\", handler)\r\n        quill.on(\"text-change\", handleTextChange)\r\n\r\n        if (quill.root) {\r\n            quill.root.addEventListener(\"keydown\", handleKeyDown)\r\n            quill.root.addEventListener(\"click\", handleClick)\r\n        }\r\n\r\n        return () => {\r\n            quill.off(\"text-change\", handler)\r\n            quill.off(\"text-change\", handleTextChange)\r\n            if (quill.root) {\r\n                quill.root.removeEventListener(\"keydown\", handleKeyDown)\r\n                quill.root.removeEventListener(\"click\", handleClick)\r\n            }\r\n        }\r\n    }, [socket, quill, handleTextChange, handleKeyDown, handleClick])\r\n\r\n\r\n    useEffect(() => {\r\n        if (!quill || !quill.root) return;\r\n        \r\n        // Create a handler that runs before Quill's internal handlers\r\n        const preemptiveTabHandler = (e) => {\r\n          if (e.key === 'Tab' && suggestionRef.current) {\r\n            console.log(\"Intercepted Tab with active suggestion\");\r\n            // Stop the event completely\r\n            e.preventDefault();\r\n            e.stopImmediatePropagation();\r\n            \r\n            // Apply the suggestion\r\n            const { start, length } = suggestionRef.current;\r\n            \r\n            // Use a timeout to ensure this runs after the event cycle\r\n            setTimeout(() => {\r\n              quill.formatText(start, length, { color: 'black', 'user-suggestion': false });\r\n              quill.setSelection(start + length, 0);\r\n              suggestionRef.current = null;\r\n            }, 0);\r\n            \r\n            return false;\r\n          }\r\n        };\r\n        \r\n        quill.root.addEventListener('keydown', preemptiveTabHandler, {\r\n          capture: true,\r\n          passive: false\r\n        });\r\n        \r\n        return () => {\r\n          quill.root.removeEventListener('keydown', preemptiveTabHandler, {\r\n            capture: true,\r\n            passive: false\r\n          });\r\n        };\r\n      }, [quill]);\r\n        \r\n    const wrapperRef = useCallback((wrapper) => {\r\n        if (wrapper === null) return\r\n\r\n        wrapper.innerHTML = \"\"\r\n        const editor = document.createElement(\"div\")\r\n        wrapper.append(editor)\r\n        const q = new Quill(editor, {\r\n            theme: \"snow\",\r\n            modules: { toolbar: TOOLBAR_OPTIONS } })\r\n\r\n        q.disable()\r\n        q.setText(\"\")\r\n\r\n        setQuill(q)\r\n\r\n    }, [])\r\n  return (\r\n        <div className=\"container\">\r\n            <div className=\"editor-container\" ref={wrapperRef}></div>\r\n            {isPredicting && (\r\n                <div className=\"prediction-indicator\">\r\n                    <small>Thinking...</small>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}